<AML>
 <Item type="SQL" id="A5E5EE02E87A4C4189E757DFBDCD094B" action="add">
  <execution_count>12</execution_count>
  <execution_flag>immediate</execution_flag>
  <old_name>UserStory_GetCompleteBom1</old_name>
  <sqlserver_body><![CDATA[CREATE PROCEDURE UserStory_GetCompleteBom1 (@id CHAR(32))
AS
BEGIN
  SELECT *
  INTO #completeBom
  FROM UserStory_GetCompleteBom2(@id);

  SELECT cb.level level, sp.id source_id,
         pb.sort_order sort_order,
          pb.id bom_id,
         rp.id related_id, rp.name related_name, rp.locked_by_id related_locked_by_id, rp.item_number related_item_number,
				 rp.as_a as_a, rp.i_want_to i_want_to, rp.so_that so_that, rp.userstory_state userstory_state
  FROM #completeBom cb INNER JOIN UserStory sp ON cb.source_id=sp.id
       INNER JOIN UserStoryRelated pb ON cb.id=pb.id
       INNER JOIN UserStory rp ON cb.related_id=rp.id
  ORDER BY cb.level, pb.sort_order

  DROP TABLE #completeBom;
END]]></sqlserver_body>
  <stale>0</stale>
  <transform_first>0</transform_first>
  <type>procedure</type>
  <name>UserStory_GetCompleteBom1</name>
 </Item>
</AML>